import json

def generate_exploit_script(file_name, json_config, json_data):
	file = open(file_name, 'w')

	file.write('from selenium import webdriver\n\n')

	file.write('browser = webdriver.Firefox()\n\n')

	# login first
	file.write('browser.get("' + json_config['login_url'] + '")\n')
	file.write('print browser.title\n\n')

	file.write('username = browser.find_element_by_name("username")\n')
	file.write('username.send_keys("' + json_config['username'] + '")\n')
	file.write('password = browser.find_element_by_name("password")\n')
	file.write('password.send_keys("' + json_config['password'] + '")\n')
	file.write('password.submit()\n\n')

	# perform attack operation
	if json_data['method'] == 'get':
		file.write('browser.get("' + json_data['action'] + '")\n\n')
	else:
		# TODO: post
		print 'should handle post'

	# file.write('browser.quit()')

	file.close()

# read config
config_file_path = '../config.json'
with open(config_file_path) as config_file:
	config = json.load(config_file)


counter = 1
with open('../phase3_sample.json') as data_file:
	data = json.load(data_file)

for obj in data:
	file_name = 'exploit_script_' + `counter` + '.py'
	generate_exploit_script(file_name, config, obj)
	counter += 1

